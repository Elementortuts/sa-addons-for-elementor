var SAShowcaseHandler = function ($scope, $) {

    var $carousel = $scope.find('.sa-el-showcase-preview').eq(0),
            $showcase_id = $carousel.attr('id'),
            $slider_wrap = $scope.find('.sa-el-showcase-preview-wrap'),
            $nav_wrap = $scope.find('.sa-el-showcase-navigation-items'),
            $nav = $scope.find('.sa-el-showcase .sa-el-showcase-navigation-item-wrap'),
            $video_wrap = $scope.find('.sa-el-showcase .sa-el-video-container'),
            $arrow_next = $scope.arrow,
            $arrow_prev = ($arrow_next !== undefined) ? $arrow_next.replace("right", "left") : '',
            $scrollable_nav = $scope.scrollable_nav,
            $preview_position = $scope.preview_position,
            $stack_on = $scope.preview_stack;

    $carousel.slick({
        slidesToShow: 1,
        slidesToScroll: 1,
        autoplay: 'yes' === $scope.autoplay,
        autoplaySpeed: $scope.autoplay_speed,
        arrows: 'yes' === $scope.arrows,
        prevArrow: '<div class="sa-el-slider-arrow sa-el-arrow sa-el-arrow-prev"><i class="' + $arrow_prev + '"></i></div>',
        nextArrow: '<div class="sa-el-slider-arrow sa-el-arrow sa-el-arrow-next"><i class="' + $arrow_next + '"></i></div>',
        dots: 'yes' === $scope.dots,
        fade: 'fade' === $scope.effect,
        speed: $scope.animation_speed,
        infinite: 'yes' === $scope.infinite_loop,
        pauseOnHover: 'yes' === $scope.pause_on_hover,
        adaptiveHeight: 'yes' === $scope.adaptive_height,
        rtl: 'right' === $scope.direction,
        asNavFor: ($scrollable_nav == 'yes') ? $nav_wrap : '',
    });

    $carousel.slick('setPosition');

    if ($scrollable_nav == 'yes') {

        $nav_wrap.slick({
            slidesToShow: ($scope.nav_items !== undefined && $scope.nav_items !== '') ? parseInt($scope.nav_items) : 5,
            slidesToScroll: 1,
            asNavFor: $carousel,
            arrows: false,
            dots: false,
            infinite: 'yes' === $scope.infinite_loop,
            focusOnSelect: true,
            vertical: ($preview_position == 'top') ? false : true,
            centerMode: true,
            centerPadding: '0px',
            responsive: [
                {
                    breakpoint: 1024,
                    settings: {
                        slidesToShow: ($scope.nav_items_tablet !== undefined && $scope.nav_items_tablet !== '') ? parseInt($scope.nav_items_tablet) : 3,
                        slidesToScroll: 1,
                        vertical: ($stack_on == 'tablet') ? false : true,
                    }
                },
                {
                    breakpoint: 768,
                    settings: {
                        slidesToShow: ($scope.nav_items_mobile !== undefined && $scope.nav_items_mobile !== '') ? parseInt($scope.nav_items_mobile) : 2,
                        slidesToScroll: 1,
                        vertical: false,
                    }
                },
            ],
        });

    } else {

        $nav.removeClass('sa-el-active-slide');
        $nav.eq(0).addClass('sa-el-active-slide');

        $carousel.on('beforeChange', function (event, slick, currentSlide, nextSlide) {
            var currentSlide = nextSlide;
            $nav.removeClass('sa-el-active-slide');
            $nav.eq(currentSlide).addClass('sa-el-active-slide');
        });

        $nav.each(function (currentSlide) {
            $(this).on('click', function (e) {
                e.preventDefault();
                $carousel.slick('slickGoTo', currentSlide);
            });
        });

    }

    if (isEditMode) {
        $slider_wrap.resize(function () {
            $carousel.slick('setPosition');
        });
    }

    var $lightbox_selector = '.slick-slide:not(.slick-cloned) .sa-el-showcase-item-link[data-fancybox="' + $showcase_id + '"]';

    $($lightbox_selector).fancybox({
        loop: true,
    });

    $video_wrap.off('click').on('click', function (e) {

        var $iframe = $("<iframe/>"),
                $vid_src = $(this).data('src'),
                $player = $(this).find('.sa-el-video-player');

        $iframe.attr('src', $vid_src);
        $iframe.attr('frameborder', '0');
        $iframe.attr('allowfullscreen', '1');
        $iframe.attr('allow', 'autoplay;encrypted-media;');

        $player.html($iframe);

    });
};
jQuery(window).on("elementor/frontend/init", function () {
    elementorFrontend.hooks.addAction(
            "frontend/element_ready/sa-el-showcase.default",
            SAShowcaseHandler
            );
});